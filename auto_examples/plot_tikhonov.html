

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tikhonov Regularization &mdash; pyglmnet 1.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  

  
    <link rel="top" title="pyglmnet 1.0.1 documentation" href="../index.html"/>
        <link rel="up" title="Examples Gallery" href="index.html"/>
        <link rel="next" title="API Documentation" href="../api.html"/>
        <link rel="prev" title="Group Lasso Regularization" href="plot_group_lasso.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> pyglmnet
          

          
          </a>

          
            
            
              <div class="version">
                1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheatsheet.html">Cheatsheet</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_multinomial.html">Multinomial Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_community_crime.html">Community and Crime</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_group_lasso.html">Group Lasso Regularization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Tikhonov Regularization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requests.html">Requests for pull requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">pyglmnet</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="index.html">Examples Gallery</a> &raquo;</li>
      
    <li>Tikhonov Regularization</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="../_sources/auto_examples/plot_tikhonov.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tikhonov-regularization">
<span id="sphx-glr-auto-examples-plot-tikhonov-py"></span><h1>Tikhonov Regularization<a class="headerlink" href="#tikhonov-regularization" title="Permalink to this headline">Â¶</a></h1>
<p>Tikhonov regularization is a generalized form of L2-regularization. It allows
us to articulate our prior knowlege about correlations between different predictors
with a multivariate Gaussian prior. Here, we demonstrate how pyglmnet&#8217;s Tikhonov
regularizer can be used to estimate spatiotemporal receptive fields (RFs) from
neural data.</p>
<p>Neurons in many brain areas, including the frontal eye fields (FEF) have RFs,
defined as regions in the visual field where visual stimuli are most likely
to result in spiking activity.</p>
<p>These spatial RFs need not be static, they can vary in time in a systematic way.
We want to characterize how such spatiotemporal RFs (STRFs) remap from one
fixation to the next. Remapping is a phenomenon where the RF of a neuron shifts
to process visual information from the subsequent fixation, prior to the onset
of the saccade. The dynamics of this shift from the &#8220;current&#8221; to the &#8220;future&#8221;
RF is an active area of research.</p>
<p>With Tikhonov regularization, we can specify a prior covariance matrix to articulate
our belief that parameters encoding neighboring points in space and time are
correlated.</p>
<p>The unpublished data are courtesy of Daniel Wood and Mark Segraves,
Department of Neurobiology, Northwestern University.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Author: Pavan Ramkumar &lt;pavan.ramkumar@gmail.com&gt;</span>
<span class="c1"># License: MIT</span>
</pre></div>
</div>
<p>Imports</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pyglmnet</span> <span class="kn">import</span> <span class="n">GLM</span>
<span class="kn">from</span> <span class="nn">spykes.strf</span> <span class="kn">import</span> <span class="n">STRF</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p>Download and fetch data files</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyglmnet.datasets</span> <span class="kn">import</span> <span class="n">fetch_tikhonov_data</span>
<span class="n">fixations_df</span><span class="p">,</span> <span class="n">probes_df</span><span class="p">,</span> <span class="n">spikes_df</span> <span class="o">=</span> <span class="n">fetch_tikhonov_data</span><span class="p">(</span><span class="n">dpath</span><span class="o">=</span><span class="s1">&#39;/tmp/glm-tools&#39;</span><span class="p">)</span>
<span class="n">spiketimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">spikes_df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<p>Design spatial basis functions</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">n_spatial_basis</span> <span class="o">=</span> <span class="mi">36</span>
<span class="n">n_temporal_basis</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">strf_model</span> <span class="o">=</span> <span class="n">STRF</span><span class="p">(</span><span class="n">patch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                  <span class="n">n_spatial_basis</span><span class="o">=</span><span class="n">n_spatial_basis</span><span class="p">,</span>
                  <span class="n">n_temporal_basis</span><span class="o">=</span><span class="n">n_temporal_basis</span><span class="p">)</span>
<span class="n">spatial_basis</span> <span class="o">=</span> <span class="n">strf_model</span><span class="o">.</span><span class="n">make_gaussian_basis</span><span class="p">()</span>
<span class="n">strf_model</span><span class="o">.</span><span class="n">visualize_gaussian_basis</span><span class="p">(</span><span class="n">spatial_basis</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_tikhonov_001.png" class="align-center" src="../_images/sphx_glr_plot_tikhonov_001.png" />
<p>Design temporal basis functions</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">time_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>
<span class="n">centers</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">75.</span><span class="p">,</span> <span class="o">-</span><span class="mf">50.</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">25.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">,</span> <span class="mf">75.</span><span class="p">]</span>
<span class="n">temporal_basis</span> <span class="o">=</span> <span class="n">strf_model</span><span class="o">.</span><span class="n">make_raised_cosine_temporal_basis</span><span class="p">(</span><span class="n">time_points</span><span class="o">=</span><span class="n">time_points</span><span class="p">,</span>
                                                              <span class="n">centers</span><span class="o">=</span><span class="n">centers</span><span class="p">,</span>
                                                              <span class="n">widths</span><span class="o">=</span><span class="mf">10.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_points</span><span class="p">,</span> <span class="n">temporal_basis</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_tikhonov_002.png" class="align-center" src="../_images/sphx_glr_plot_tikhonov_002.png" />
<p>Design parameters</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Spatial extent</span>
<span class="n">n_shape</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="n">n_spatial_basis</span>

<span class="c1"># Window of interest</span>
<span class="n">window</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>

<span class="c1"># Bin size</span>
<span class="n">binsize</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># Zero pad bins</span>
<span class="n">n_zero_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">window</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">binsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Build design matrix</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">bin_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">window</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">binsize</span><span class="p">)</span>
<span class="n">n_bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_template</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="n">probetimes</span> <span class="o">=</span> <span class="n">probes_df</span><span class="p">[</span><span class="s1">&#39;t_probe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">spatial_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_features</span><span class="p">))</span>
<span class="n">spike_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>
<span class="n">fixation_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>

<span class="c1"># For each fixation</span>
<span class="k">for</span> <span class="n">fx</span> <span class="ow">in</span> <span class="n">fixations_df</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]:</span>

    <span class="c1"># Fixation time</span>
    <span class="n">fixation_time</span> <span class="o">=</span> <span class="n">fixations_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fx</span><span class="p">][</span><span class="s1">&#39;t_fix_f&#39;</span><span class="p">]</span>

    <span class="n">this_fixation_spatial_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">n_spatial_basis</span><span class="p">))</span>
    <span class="n">this_fixation_spikecounts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_bins</span><span class="p">)</span>
    <span class="n">unique_fixation_id</span> <span class="o">=</span> <span class="n">fixations_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fx</span><span class="p">][</span><span class="s1">&#39;trialNum_f&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">fixations_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fx</span><span class="p">][</span><span class="s1">&#39;fixNum_f&#39;</span><span class="p">]</span>
    <span class="n">this_fixation_id</span> <span class="o">=</span> <span class="n">unique_fixation_id</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_bins</span><span class="p">)</span>

    <span class="c1"># Look for probes in window of interest relative to fixation</span>
    <span class="n">probe_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">probetimes</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">fixation_time</span> <span class="o">+</span> <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
                                 <span class="n">fixation_time</span> <span class="o">+</span> <span class="n">window</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">])</span>

    <span class="c1"># For each such probe</span>
    <span class="k">for</span> <span class="n">probe_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">probe_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">probe_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>

        <span class="c1"># Check if probe lies within spatial region of interest</span>
        <span class="n">fix_row</span> <span class="o">=</span> <span class="n">fixations_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fx</span><span class="p">][</span><span class="s1">&#39;y_curFix_f&#39;</span><span class="p">]</span>
        <span class="n">fix_col</span> <span class="o">=</span> <span class="n">fixations_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fx</span><span class="p">][</span><span class="s1">&#39;x_curFix_f&#39;</span><span class="p">]</span>
        <span class="n">probe_row</span> <span class="o">=</span> <span class="n">probes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">probe_id</span><span class="p">][</span><span class="s1">&#39;y_probe&#39;</span><span class="p">]</span>
        <span class="n">probe_col</span> <span class="o">=</span> <span class="n">probes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">probe_id</span><span class="p">][</span><span class="s1">&#39;x_probe&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">probe_row</span> <span class="o">-</span> <span class="n">fix_row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">n_shape</span> <span class="o">/</span> <span class="mi">2</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">probe_row</span> <span class="o">-</span> <span class="n">fix_row</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_shape</span> <span class="o">/</span> <span class="mi">2</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">probe_col</span> <span class="o">-</span> <span class="n">fix_col</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">n_shape</span> <span class="o">/</span> <span class="mi">2</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">probe_col</span> <span class="o">-</span> <span class="n">fix_col</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_shape</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>

            <span class="c1"># Get probe timestamp relative to fixation</span>
            <span class="n">probe_time</span> <span class="o">=</span> <span class="n">probes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">probe_id</span><span class="p">][</span><span class="s1">&#39;t_probe&#39;</span><span class="p">]</span>
            <span class="n">probe_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bin_template</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">probe_time</span> <span class="o">-</span> <span class="n">fixation_time</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Define an image based on the relative locations</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_shape</span><span class="p">,</span> <span class="n">n_shape</span><span class="p">))</span>
            <span class="n">row</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">probe_row</span> <span class="o">-</span> <span class="n">fix_row</span><span class="p">)</span> <span class="o">+</span> <span class="n">n_shape</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">probe_col</span> <span class="o">-</span> <span class="n">fix_col</span><span class="p">)</span> <span class="o">+</span> <span class="n">n_shape</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">img</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Compute projection</span>
            <span class="n">basis_projection</span> <span class="o">=</span> <span class="n">strf_model</span><span class="o">.</span><span class="n">project_to_spatial_basis</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">spatial_basis</span><span class="p">)</span>
            <span class="n">this_fixation_spatial_features</span><span class="p">[</span><span class="n">probe_bin</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">basis_projection</span>

    <span class="c1"># Count spikes in window of interest relative to fixation</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">fixation_time</span> <span class="o">+</span> <span class="n">bin_template</span>
    <span class="n">searchsorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">,</span>
                                       <span class="p">[</span><span class="n">fixation_time</span> <span class="o">+</span> <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">fixation_time</span> <span class="o">+</span> <span class="n">window</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">this_fixation_spike_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">[</span><span class="n">searchsorted_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                                         <span class="n">searchsorted_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">bins</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Accumulate</span>
    <span class="n">fixation_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">fixation_id</span><span class="p">,</span> <span class="n">this_fixation_id</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">spatial_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">spatial_features</span><span class="p">,</span> <span class="n">this_fixation_spatial_features</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">spike_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">spike_counts</span><span class="p">,</span> <span class="n">this_fixation_spike_counts</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Zero pad</span>
    <span class="n">spatial_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">spatial_features</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_zero_bins</span><span class="p">,</span> <span class="n">n_spatial_basis</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fixation_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">fixation_id</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_zero_bins</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Convolve with temporal basis</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">strf_model</span><span class="o">.</span><span class="n">convolve_with_temporal_basis</span><span class="p">(</span><span class="n">spatial_features</span><span class="p">,</span> <span class="n">temporal_basis</span><span class="p">)</span>

<span class="c1"># Remove zeropad</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">fixation_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">999.</span><span class="p">]</span>
</pre></div>
</div>
<p>Visualize the distribution of spike counts</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">spike_counts</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_tikhonov_003.png" class="align-center" src="../_images/sphx_glr_plot_tikhonov_003.png" />
<p>Plot a few rows of the design matrix</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">150</span><span class="p">,:],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_tikhonov_004.png" class="align-center" src="../_images/sphx_glr_plot_tikhonov_004.png" />
<p>Design prior covariance matrix for Tikhonov regularization</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">prior_cov</span> <span class="o">=</span> <span class="n">strf_model</span><span class="o">.</span><span class="n">design_prior_covariance</span><span class="p">(</span><span class="n">sigma_temporal</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">sigma_spatial</span><span class="o">=</span><span class="mf">5.</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prior_cov</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">prior_cov</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_tikhonov_005.png" class="align-center" src="../_images/sphx_glr_plot_tikhonov_005.png" />
<p>Fit models</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">Xtrain</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">,</span> <span class="n">Ytest</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">spike_counts</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyglmnet</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="n">Xtrain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Tau</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tikhonov_from_prior</span><span class="p">(</span><span class="n">prior_cov</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>

<span class="n">glm</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span><span class="n">distr</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">Tau</span><span class="o">=</span><span class="n">Tau</span><span class="p">,</span> <span class="n">score_metric</span><span class="o">=</span><span class="s1">&#39;pseudo_R2&#39;</span><span class="p">)</span>
<span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">)</span>
<span class="n">cvopt_lambda</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;train score: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">glm</span><span class="p">[</span><span class="n">cvopt_lambda</span><span class="p">]</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;test score: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">glm</span><span class="p">[</span><span class="n">cvopt_lambda</span><span class="p">]</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">))</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">glm</span><span class="p">[</span><span class="n">cvopt_lambda</span><span class="p">]</span><span class="o">.</span><span class="n">fit_</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span></span>  train score: 0.002045
test score: 0.001156
</pre></div>
</div>
<p>Visualize</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">time_bin_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_temporal_basis</span><span class="p">):</span>
    <span class="n">RF</span> <span class="o">=</span> <span class="n">strf_model</span><span class="o">.</span><span class="n">make_image_from_spatial_basis</span><span class="p">(</span><span class="n">spatial_basis</span><span class="p">,</span>
                                             <span class="n">weights</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">time_bin_</span><span class="p">,</span>
                                                           <span class="n">n_spatial_basis</span> <span class="o">*</span> <span class="n">n_temporal_basis</span><span class="p">,</span>
                                                           <span class="n">n_temporal_basis</span><span class="p">)])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_temporal_basis</span><span class="p">,</span> <span class="n">time_bin_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">RF</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">titletext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="n">time_bin_</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">titletext</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_tikhonov_006.png" class="align-center" src="../_images/sphx_glr_plot_tikhonov_006.png" />
<p><strong>Total running time of the script:</strong>
(0 minutes 33.799 seconds)</p>
<div class="sphx-glr-download container">
<strong>Download Python source code:</strong> <a class="reference download internal" href="../_downloads/plot_tikhonov.py"><tt class="xref download docutils literal"><span class="pre">plot_tikhonov.py</span></tt></a></div>
<div class="sphx-glr-download container">
<strong>Download IPython notebook:</strong> <a class="reference download internal" href="../_downloads/plot_tikhonov.ipynb"><tt class="xref download docutils literal"><span class="pre">plot_tikhonov.ipynb</span></tt></a></div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_group_lasso.html" class="btn btn-neutral" title="Group Lasso Regularization" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Pavan Ramkumar.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>